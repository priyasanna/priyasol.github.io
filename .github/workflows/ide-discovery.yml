name: Weekly AI IDE Discovery

on:
  schedule:
    # Run every Monday at 9 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch: # Allow manual trigger

jobs:
  discover:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Run IDE discovery script
        run: |
          cd ai-ide-comparison
          node auto-discover.js
      
      - name: Create Pull Request if discoveries found
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'feat: Weekly AI IDE discovery results'
          title: 'üîç New AI IDEs Discovered - Weekly Scan'
          body: |
            ## Automated AI IDE Discovery
            
            This PR contains the results of the weekly AI IDE discovery scan.
            
            **Review the discoveries:**
            - Check `ai-ide-comparison/discoveries-*.md` for the full report
            - Manually test promising IDEs
            - Update the comparison page if warranted
            
            **Next Steps:**
            1. Review each discovery
            2. Test viable candidates (2-4 hours each)
            3. Assign tier (S/A/B)
            4. Update `ai-ide-comparison/index.html`
            5. Merge this PR
          branch: ide-discovery-automated
          delete-branch: true
      
      - name: Comment on issue if discoveries found
        if: success()
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const discoveries = fs.readdirSync('ai-ide-comparison')
              .filter(f => f.startsWith('discoveries-') && f.endsWith('.json'));
            
            if (discoveries.length > 0) {
              const data = JSON.parse(fs.readFileSync(`ai-ide-comparison/${discoveries[0]}`, 'utf8'));
              
              github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `üîç ${data.length} New AI IDEs Discovered`,
                body: `Automated discovery found ${data.length} potential new AI IDEs.\n\nCheck the PR for details and manual review.`,
                labels: ['ai-ides', 'automated-discovery', 'needs-review']
              });
            }

